# SonicVision 功能规范文档

## 目录

- [功能概述](#功能概述)
- [核心功能模块](#核心功能模块)
  - [音频捕获与分析](#音频捕获与分析)
  - [歌曲识别](#歌曲识别)
  - [可视化效果](#可视化效果)
  - [用户控制面板](#用户控制面板)
  - [多语言支持](#多语言支持)
  - [响应式设计](#响应式设计)
- [用户流程](#用户流程)
  - [首次启动](#首次启动)
  - [正常使用](#正常使用)
  - [暂停/继续](#暂停/继续)
- [用户界面设计规范](#用户界面设计规范)
- [配置选项](#配置选项)
  - [可视化设置](#可视化设置)
  - [歌词设置](#歌词设置)
  - [语言设置](#语言设置)
- [错误处理](#错误处理)
  - [常见错误](#常见错误)
  - [错误提示](#错误提示)
- [性能要求](#性能要求)
  - [响应时间](#响应时间)
  - [资源使用](#资源使用)
- [安全考虑](#安全考虑)
  - [隐私保护](#隐私保护)
  - [API 安全](#api-安全)
- [未来功能扩展](#未来功能扩展)
  - [计划中的功能](#计划中的功能)
  - [技术扩展](#技术扩展)
- [功能路线图](#功能路线图)

## 功能概述

SonicVision 是一个基于 AI 的音乐可视化应用，提供以下核心功能：

- 实时音频分析和可视化
- AI 驱动的歌曲识别
- 多模式可视化效果（2D 和 3D）
- 自定义可视化参数
- 多语言支持
- 响应式设计

## 核心功能模块

### 音频捕获与分析

**功能描述**：
- 通过浏览器的 Web Audio API 捕获麦克风输入
- 实时分析音频频率数据
- 支持选择不同的音频输入设备
- 检测音乐开始和结束，自动触发歌曲识别

**技术实现**：
- 使用 `navigator.mediaDevices.getUserMedia()` 获取音频流
- 使用 `AnalyserNode` 分析音频频率
- 使用 `MediaRecorder` 录制音频片段用于识别

**用户交互**：
- 开始/停止音频捕获的按钮
- 音频设备选择下拉菜单

### 歌曲识别

**功能描述**：
- 定期录制音频片段并发送到 Google Gemini API 进行识别
- 显示识别结果，包括歌曲标题、艺术家和歌词片段
- 提供歌曲搜索链接
- 支持多语言识别

**技术实现**：
- 使用 Google Gemini API 的音频识别能力
- 实现智能的识别调度，避免频繁 API 调用
- 处理 API 错误和重试逻辑

**用户交互**：
- 手动重试识别的按钮
- 关闭歌曲信息的按钮

### 可视化效果

**功能描述**：
- 支持多种 2D 可视化模式
- 支持 3D WebGL 可视化模式
- 根据音频数据实时生成动态效果
- 支持显示歌词（如果可用）

**技术实现**：
- 使用 Canvas 2D API 实现 2D 效果
- 使用 Three.js WebGL 实现 3D 效果
- 实现策略模式，为每种模式提供独立的渲染逻辑

**支持的可视化模式**：

#### 2D 模式
- **BARS**：频谱柱状图，显示不同频率的音量
- **PLASMA**：等离子体效果，根据音频数据变形
- **PARTICLES**：粒子效果，粒子随音乐运动
- **TUNNEL**：隧道效果，随音乐节奏移动
- **SHAPES**：几何形状效果，形状随音乐变化
- **RINGS**：环形效果，同心环随音乐脉动
- **NEBULA**：星云效果，类似烟雾的动态效果
- **KALEIDOSCOPE**：万花筒效果，对称图案随音乐变化

#### 3D 模式
- **SILK**：丝绸效果，流动的 3D 表面
- **LIQUID**：液体效果，波动的 3D 表面
- **TERRAIN**：地形效果，起伏的 3D 地形

### 用户控制面板

**功能描述**：
- 切换可视化模式
- 调整可视化参数（灵敏度、速度、 glow、trails）
- 选择颜色主题
- 调整歌词显示样式和开关
- 切换界面语言
- 重置或随机化设置

**技术实现**：
- 使用 React 状态管理控制参数
- 使用 localStorage 持久化用户设置
- 实现响应式设计，适配不同屏幕尺寸

**用户交互**：
- 滑块控件调整数值参数
- 开关按钮控制布尔参数
- 下拉菜单选择模式和样式
- 颜色选择器选择主题

### 多语言支持

**功能描述**：
- 支持英语和中文界面
- 根据用户浏览器设置自动选择语言
- 允许用户手动切换语言

**技术实现**：
- 使用 `translations.ts` 文件存储多语言字符串
- 实现简单的翻译函数

### 响应式设计

**功能描述**：
- 适配不同屏幕尺寸，从手机到桌面
- 在小屏幕上优化控件布局
- 保持可视化效果的完整性

**技术实现**：
- 使用 CSS 媒体查询
- 使用相对单位和弹性布局

## 用户流程

### 首次启动

1. 用户访问应用
2. 应用显示欢迎界面
3. 用户点击「开始体验」按钮
4. 应用请求麦克风权限
5. 用户授权麦克风访问
6. 应用开始音频捕获和分析
7. 应用开始识别歌曲

### 正常使用

1. 应用实时显示可视化效果
2. 当检测到音乐时，应用尝试识别歌曲
3. 识别成功后，显示歌曲信息和歌词
4. 用户可以调整可视化参数
5. 用户可以切换可视化模式
6. 用户可以切换界面语言

### 暂停/继续

1. 用户点击麦克风开关按钮
2. 应用停止音频捕获
3. 应用显示欢迎界面
4. 用户再次点击开始按钮
5. 应用重新开始音频捕获和分析

## 用户界面设计规范

### 设计原则

- **简洁明了**：界面布局简洁，功能明确
- **视觉一致性**：保持视觉元素的一致性，包括颜色、字体和间距
- **响应式设计**：适配不同屏幕尺寸
- **可访问性**：确保所有用户都能使用应用，包括残障用户

### 颜色方案

- **主色调**：深蓝色 (#1a237e) 和紫色 (#7b1fa2)
- **辅助色**：青色 (#00bcd4) 和粉色 (#e91e63)
- **背景色**：黑色或深色渐变
- **文本色**：白色或浅灰色

### 字体选择

- **标题**：无衬线字体，如 Roboto 或 Open Sans
- **正文**：无衬线字体，如 Roboto 或 Open Sans
- **字体大小**：根据屏幕尺寸自适应

### 布局规范

- **桌面端**：控制面板位于屏幕底部，可折叠
- **移动端**：控制面板位于屏幕底部，通过手势或按钮展开
- **可视化区域**：占据整个屏幕，作为背景
- **信息覆盖层**：居中显示，半透明背景

## 配置选项

### 可视化设置

| 设置项 | 类型 | 默认值 | 范围 | 描述 |
|--------|------|--------|------|------|
| sensitivity | 数字 | 1.5 | 1.0-3.0 | 可视化对音频的敏感度 |
| speed | 数字 | 1.0 | 0.5-2.0 | 可视化效果的速度 |
| glow | 布尔值 | true | true/false | 启用发光效果 |
| trails | 布尔值 | true | true/false | 启用轨迹效果 |
| autoRotate | 布尔值 | false | true/false | 自动切换可视化模式 |
| rotateInterval | 数字 | 30 | 10-60 | 自动切换模式的间隔（秒） |

### 歌词设置

| 设置项 | 类型 | 默认值 | 选项 | 描述 |
|--------|------|--------|------|------|
| showLyrics | 布尔值 | true | true/false | 显示歌词 |
| lyricsStyle | 枚举 | KARAOKE | STANDARD, KARAOKE, MINIMAL | 歌词显示样式 |

### 语言设置

| 设置项 | 类型 | 默认值 | 选项 | 描述 |
|--------|------|--------|------|------|
| language | 字符串 | zh | en, zh | 界面语言 |
| region | 字符串 | 自动检测 | global, US, CN, JP, KR, EU, LATAM | 地区设置（影响歌曲识别） |

## 错误处理

### 常见错误

| 错误类型 | 描述 | 处理方式 |
|----------|------|----------|
| 麦克风权限被拒绝 | 用户拒绝授予麦克风访问权限 | 显示错误提示，引导用户在浏览器设置中授予权限 |
| 无法访问音频设备 | 没有可用的音频输入设备 | 显示错误提示，建议用户连接麦克风 |
| API 调用失败 | Google Gemini API 调用失败 | 实现重试逻辑，显示加载指示器 |
| 歌曲识别失败 | API 无法识别歌曲 | 显示提示信息，允许用户手动重试 |
| 浏览器不支持 | 浏览器缺少必要的 API | 显示错误提示，建议使用现代浏览器 |
| 网络连接问题 | 无法连接到 API 服务器 | 显示网络错误提示，建议检查网络连接 |
| 音频录制失败 | 无法录制音频片段 | 显示错误提示，建议刷新页面重试 |

### 错误提示

- 使用友好的错误消息
- 提供明确的解决步骤
- 在界面上显示错误状态
- 使用适当的图标和颜色表示错误类型

## 性能要求

### 响应时间

- 音频分析和可视化更新应在 16ms 内完成（60fps）
- 歌曲识别应在 3-5 秒内完成（包括录制和 API 调用）
- 控制面板操作应在 100ms 内响应

### 资源使用

- 内存使用应保持在合理范围内，避免内存泄漏
- CPU 使用应优化，确保在低性能设备上也能流畅运行
- 网络请求应优化，减少 API 调用次数

## 安全考虑

### 隐私保护

- 音频数据仅用于实时分析和歌曲识别，不存储在服务器上
- 仅在用户授权后访问麦克风
- 明确的隐私政策和数据使用说明

### API 安全

- 安全处理 API 密钥（如果使用）
- 避免在客户端代码中硬编码敏感信息
- 实现 API 调用限制，防止滥用

## 未来功能扩展

### 计划中的功能

- **音频文件上传**：支持上传音频文件进行分析和可视化
- **流媒体集成**：支持从 Spotify、YouTube Music 等流媒体服务获取音频
- **自定义主题**：允许用户创建和共享自定义颜色主题
- **可视化编辑器**：提供可视化效果的自定义工具
- **社交分享**：允许用户分享可视化效果和识别结果
- **更多 3D 模式**：添加更多 WebGL 可视化模式
- **音频效果**：添加音频增强和效果处理

### 技术扩展

- **PWA 支持**：实现渐进式 Web 应用，支持离线使用
- **移动应用**：开发原生移动应用
- **后端服务**：实现后端服务，支持更多功能
- **机器学习模型**：集成本地机器学习模型，减少对外部 API 的依赖

## 功能路线图

### 第一阶段（当前版本）
- 实时音频分析和可视化
- AI 驱动的歌曲识别
- 多模式可视化效果（2D 和 3D）
- 自定义可视化参数
- 多语言支持
- 响应式设计

### 第二阶段（近期计划）
- 音频文件上传
- 自定义主题
- 社交分享
- 更多 3D 可视化模式

### 第三阶段（长期计划）
- 流媒体集成
- 可视化编辑器
- PWA 支持
- 移动应用
- 后端服务
- 本地机器学习模型
