# SonicVision 项目规范文档

## 目录

- [项目概述](#项目概述)
- [技术栈](#技术栈)
- [项目规范](#项目规范)
  - [代码风格](#代码风格)
  - [架构模式](#架构模式)
  - [测试策略](#测试策略)
  - [Git 工作流](#git-工作流)
- [领域上下文](#领域上下文)
- [重要约束](#重要约束)
- [外部依赖](#外部依赖)
- [版本管理](#版本管理)
- [部署和发布流程](#部署和发布流程)

## 项目概述

SonicVision 是一款基于 AI 技术的音乐可视化应用，致力于通过实时音频分析和 AI 歌曲识别，为用户打造沉浸式的音乐视觉体验。该应用能够实时捕获并分析音频输入，识别正在播放的歌曲，并根据音乐的节奏和特征生成动态、美观的视觉效果。

## 技术栈

- TypeScript：提供类型安全和更好的开发体验
- React 18.3.1：构建用户界面的核心库
- Vite：现代化的前端构建工具
- Three.js 0.164.1：实现 3D 可视化效果
- @react-three/fiber 8.16.8：React 与 Three.js 的桥接库
- @react-three/postprocessing 2.16.2：Three.js 后期处理效果
- @google/genai 1.35.0：Google Gemini API 客户端

## 项目规范

### 代码风格

- 严格使用 TypeScript 进行类型检查，确保代码质量
- 组件命名采用 PascalCase 格式（如 `VisualizerCanvas`）
- 变量和函数命名采用 camelCase 格式（如 `startAudio`）
- 常量命名采用 UPPER_SNAKE_CASE 格式（如 `DEFAULT_MODE`）
- 每个代码文件头部需添加文件名、版本号、更新日期时间等注释
- 生成代码时必须添加函数级注释，说明函数用途、参数和返回值

### 架构模式

- **组件化架构**：将用户界面拆分为可复用、独立的组件
- **服务层**：将业务逻辑（如歌曲识别）封装在专门的服务中
- **状态管理**：使用 React 的 useState 和 useEffect 钩子进行状态管理
- **策略模式**：为不同的可视化模式实现独立的渲染策略，提高代码可维护性

### 测试策略

- 编写全面的单元测试和集成测试，覆盖核心功能
- 确保代码覆盖率不低于 80%，保证代码质量
- 每次提交代码前必须运行测试，确保不会破坏现有功能

### Git 工作流

- **main 分支**：主分支，用于发布稳定版本
- **dev 分支**：开发分支，集成所有功能开发
- **功能分支**：命名格式为 `feature/功能名`，用于开发新功能
- **修复分支**：命名格式为 `fix/问题描述`，用于修复 bug
- **提交消息**：使用语义化提交消息，格式为 `<类型>: <描述>`（如 `feat: 添加 3D 可视化模式`）

## 领域上下文

- **音频分析**：利用 Web Audio API 进行实时音频频率分析
- **歌曲识别**：通过 Google Gemini API 识别正在播放的歌曲
- **可视化技术**：结合 Canvas 2D 和 Three.js WebGL 实现多样化的音乐可视化效果
- **本地化支持**：提供多语言界面，增强用户体验

## 重要约束

- **麦克风权限**：需要用户明确授权麦克风访问权限
- **API 依赖**：依赖 Google Gemini API 进行歌曲识别，需要有效的 API 密钥
- **浏览器兼容性**：要求浏览器支持 Web Audio API 和 MediaRecorder API

## 外部依赖

- **Google Gemini API**：提供 AI 驱动的歌曲识别能力
- **Three.js**：实现高质量的 3D WebGL 可视化效果
- **React**：构建响应式、交互式的用户界面
- **Vite**：提供快速的开发服务器和高效的构建流程

## 版本管理

采用语义化版本规范（SemVer）：`MAJOR.MINOR.PATCH`

- **MAJOR**：表示不兼容的 API 变更
- **MINOR**：表示向后兼容的功能添加
- **PATCH**：表示向后兼容的 bug 修复

所有代码文件的版本号应保持同步，统一在文件头部注释中进行管理。

## 部署和发布流程

1. **开发环境**：使用 `npm run dev` 启动本地开发服务器
2. **构建**：使用 `npm run build` 构建生产版本
3. **预览**：使用 `npm run preview` 预览生产构建结果
4. **部署**：将构建产物部署到目标服务器
5. **发布**：更新版本号并创建发布标签

### 发布流程详细步骤

1. 确保所有测试通过，无任何错误
2. 更新项目版本号，遵循语义化版本规范
3. 构建生产版本，确保构建过程无错误
4. 部署到测试环境进行全面验证
5. 验证通过后，部署到生产环境
6. 创建发布标签和详细的发布说明，记录版本变更内容
